<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Galaxy of Love</title>

  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

  <!-- Font Awesome (for the WhatsApp icon in case needed) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

  <style>
    /* ---------- Reset & layout ---------- */
    * { margin:0; padding:0; box-sizing:border-box; }
    html,body { height:100%; background:#000; font-family: Georgia, serif; overflow:hidden; color:#fff; }
    .webgl { position:fixed; inset:0; width:100%; height:100%; display:block; }

    /* Floating CSS hearts in background */
    .heart {
      position:absolute;
      color: rgba(255,100,100,0.14);
      font-size: 24px;
      animation: float 15s infinite ease-in-out;
      z-index:0;
      pointer-events:none;
      user-select:none;
    }
    @keyframes float {
      0%,100%{ transform: translateY(0) rotate(0deg); opacity:0.3; }
      50%{ transform: translateY(-20px) rotate(10deg); opacity:0.7; }
    }

    /* UI text overlays */
    .credits {
      position:fixed; bottom:15px; left:50%; transform:translateX(-50%);
      font-family:'Pacifico', cursive; font-size:16px; text-align:center;
      text-shadow:0 0 3px #fff, 0 0 6px #fff, 0 0 10px #ff6030, 0 0 15px #ff6030;
      z-index:10; pointer-events:none;
    }
    .instructions {
      position:fixed; top:20px; left:50%; transform:translateX(-50%);
      color:rgba(255,255,255,0.85); font-family:Georgia, serif; font-size:14px;
      text-align:center; background:rgba(0,0,0,0.28); padding:8px 16px; border-radius:20px;
      backdrop-filter: blur(5px); z-index:10;
    }

    /* Config menu */
    .menu-button {
      position:fixed; top:15px; left:15px; width:40px; height:40px;
      background:rgba(0,0,0,0.4); border-radius:50%; display:flex; flex-direction:column;
      justify-content:center; align-items:center; cursor:pointer; z-index:20;
      backdrop-filter: blur(5px);
    }
    .menu-button span { display:block; width:20px; height:2px; background:white; margin:2px 0; border-radius:1px; }

    .overlay { position:fixed; inset:0; background:rgba(0,0,0,0.5); z-index:14; display:none; }
    .overlay.active { display:block; }

    .config-panel {
      position:fixed; top:0; left:-320px; width:300px; height:100%; background:rgba(10,10,20,0.95);
      backdrop-filter: blur(10px); z-index:15; padding:20px; display:flex; flex-direction:column; overflow-y:auto;
      transition:left .28s ease; border-right:1px solid rgba(255,96,48,0.28);
    }
    .config-panel.open { left:0; }
    .config-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.12); }
    .config-title { color:white; font-family:'Pacifico', cursive; font-size:22px; }
    .close-button { background:none; border:none; color:white; font-size:20px; cursor:pointer; width:34px; height:34px; border-radius:50%; }
    .close-button:hover { background:rgba(255,255,255,0.06); }

    .config-section { margin-bottom:18px; padding:12px; background:rgba(30,30,40,0.6); border-radius:12px; }
    .config-section h3 { color:#ff6030; margin-bottom:10px; font-family:'Pacifico', cursive; font-size:18px; }
    .config-option { margin-bottom:10px; }
    .config-option label { display:block; color:white; margin-bottom:6px; font-size:13px; }

    input[type="range"] { width:100%; height:6px; background:rgba(255,255,255,0.08); border-radius:3px; -webkit-appearance:none; }
    input[type="range"]::-webkit-slider-thumb { -webkit-appearance:none; width:14px; height:14px; border-radius:50%; background:#ff6030; cursor:pointer; }

    .toggle-switch { position:relative; display:inline-block; width:50px; height:24px; }
    .toggle-switch input { opacity:0; width:0; height:0; }
    .slider { position:absolute; cursor:pointer; inset:0; background:#ccc; border-radius:24px; transition:.25s; }
    .slider:before { position:absolute; content:""; height:16px; width:16px; left:4px; bottom:4px; background:white; transition:.25s; border-radius:50%; }
    input:checked + .slider { background:#ff6030; }
    input:checked + .slider:before { transform:translateX(26px); }

    .color-options { display:flex; gap:8px; flex-wrap:wrap; }
    .color-option { width:28px; height:28px; border-radius:50%; cursor:pointer; border:2px solid transparent; transition:transform .12s; }
    .color-option:hover { transform:scale(1.08); }
    .color-option.active { border-color:white; transform:scale(1.12); }

    .developer-info { margin-top:auto; padding:14px; background:rgba(20,20,30,0.8); border-radius:12px; text-align:center; border:1px solid rgba(255,96,48,0.18); }
    .developer-info h3 { color:#ff6030; margin-bottom:8px; font-family:'Pacifico', cursive; font-size:18px; }
    .developer-info p { color:rgba(255,255,255,0.9); font-size:14px; line-height:1.4; }

    .whatsapp-link { display:inline-flex; align-items:center; justify-content:center; background:#25D366; color:white; text-decoration:none; padding:10px 14px; border-radius:22px; font-weight:bold; margin-top:8px; }
    .whatsapp-link i { margin-right:8px; }

    /* responsive tweaks */
    @media (max-width:768px) {
      .config-panel { width:280px; }
      .config-title { font-size:20px; }
      .instructions { font-size:12px; padding:6px 12px; }
    }
    @media (max-width:480px) {
      .config-panel { width:100%; left:-100%; }
      .config-panel.open { left:0; }
    }
  </style>
</head>
<body>
  <canvas class="webgl" aria-hidden="true"></canvas>

  <div class="instructions">Te Amo Muchote</div>
  <div class="credits">By MR</div>

  <div class="menu-button" id="menuButton" title="Abrir men√∫ de configuraci√≥n" aria-label="Abrir men√∫ de configuraci√≥n">
    <span></span><span></span><span></span>
  </div>

  <div class="overlay" id="overlay" tabindex="-1"></div>

  <div class="config-panel" id="configPanel" aria-hidden="true">
    <div class="config-header">
      <div class="config-title">Configuraci√≥n</div>
      <button class="close-button" id="closeButton" aria-label="Cerrar men√∫">‚úï</button>
    </div>

    <div class="config-section">
      <h3>Corazones Orbitales</h3>
      <div class="config-option">
        <label for="heartSize">Tama√±o</label>
        <input type="range" id="heartSize" min="0.3" max="1.2" step="0.1" value="0.8">
      </div>
      <div class="config-option">
        <label for="heartSpeed">Velocidad de rotaci√≥n</label>
        <input type="range" id="heartSpeed" min="0" max="1" step="0.05" value="0.25">
      </div>
      <div class="config-option">
        <label>Color principal</label>
        <div class="color-options" id="colorOptions">
          <div class="color-option active" style="background:#FFD700" data-color="#FFD700" title="Amarillo"></div>
          <div class="color-option" style="background:#C7B8EA" data-color="#C7B8EA" title="Lavanda"></div>
          <div class="color-option" style="background:#800080" data-color="#800080" title="Morado"></div>
          <div class="color-option" style="background:#0949f0" data-color="#0949f0" title="Azul"></div>
          <div class="color-option" style="background:#8a2be2" data-color="#8a2be2" title="Violeta"></div>
          <div class="color-option" style="background:#01ffff" data-color="#01ffff" title="Cian"></div>
        </div>
      </div>
    </div>

    <div class="config-section">
      <h3>Coraz√≥n Central</h3>
      <div class="config-option">
        <label for="centerHeartSize">Tama√±o</label>
        <input type="range" id="centerHeartSize" min="2.0" max="5.0" step="0.2" value="3.2">
      </div>
    </div>

    <div class="config-section">
      <h3>Fondo Estelar</h3>
      <div class="config-option">
        <label for="starBrightness">Brillo de estrellas</label>
        <input type="range" id="starBrightness" min="0.3" max="1.0" step="0.05" value="0.85">
      </div>
    </div>

    <div class="config-section">
      <h3>Opciones Avanzadas</h3>
      <div class="config-option">
        <label>Rotaci√≥n autom√°tica</label>
        <label class="toggle-switch">
          <input type="checkbox" id="autoRotateToggle" checked>
          <span class="slider" aria-hidden="true"></span>
        </label>
      </div>
      <div class="config-option">
        <label for="textOpacity">Opacidad de textos rom√°nticos</label>
        <input type="range" id="textOpacity" min="0.1" max="1.0" step="0.05" value="0.9">
      </div>
    </div>

    <div class="developer-info">
      <h3>MR</h3>
      <p>Te Amo Muchote Mi Ni√±a Hermosa</p>
      <p style="font-size:12px; color:rgba(255,255,255,0.65); margin-top:8px;">And</p>
    </div>
  </div>

  <!-- Background audio (start muted to avoid autoplay blocks). We set src via JS so we can encode it safely. -->
  <audio id="bg-music" loop preload="auto"></audio>

  <!-- Three.js scene (module import) -->
  <script type="module">
    // Use a stable ESM build of Three.js. If blocked by CSP, consider bundling or serving locally.
    import * as THREE from 'https://unpkg.com/three@0.132.2/build/three.module.js';
    import { OrbitControls } from 'https://unpkg.com/three@0.132.2/examples/jsm/controls/OrbitControls.js';

    /* ---------- Helper: background CSS hearts ---------- */
    function createCSSHearts() {
      const heartSymbols = ['üíõ','ü©µ','üå∑','üíú','üå∏','üòä','‚ùáÔ∏è','üëë','üíñ','üíû'];
      const container = document.body;
      const heartCount = 28;
      for (let i=0;i<heartCount;i++){
        const heart = document.createElement('div');
        heart.className = 'heart';
        heart.textContent = heartSymbols[Math.floor(Math.random() * heartSymbols.length)];
        heart.style.left = `${Math.random() * 100}%`;
        heart.style.top = `${Math.random() * 100}%`;
        heart.style.fontSize = `${12 + Math.random()*28}px`;
        heart.style.animationDelay = `${Math.random()*14}s`;
        container.appendChild(heart);
      }
    }
    createCSSHearts();

    /* ---------- Scene parameters (tuned for typical laptops/phones) ---------- */
    const params = {
      heartCount: 12,
      particlesPerHeart: 800,
      heartSize: 0.8,
      heartSizeVariation: 0.18,
      insideColor: '#ff0055',
      outsideColor: '#ff3088',
      centerHeartSize: 3.2,
      centerHeartParticles: 1800,
      nucleusParticles: 700,
      heartCoreParticles: 90,
      autoRotateSpeed: 0.25,
      starOpacity: 0.85,
      textOpacity: 0.9,
      autoRotate: true
    };

    const canvas = document.querySelector('.webgl');
    const scene = new THREE.Scene();

    // Text sprites helpers (uses canvas textures)
    function makeTextSprite(text, font = 'Bold 28px Pacifico', w=320,h=80, gradientColors=['#ff6030','#ffffff','#0949f0']){
      const c = document.createElement('canvas');
      c.width = w; c.height = h;
      const ctx = c.getContext('2d');
      ctx.clearRect(0,0,w,h);
      ctx.font = font;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      const grad = ctx.createLinearGradient(0,0,w,0);
      grad.addColorStop(0, gradientColors[0]);
      grad.addColorStop(0.5, gradientColors[1]);
      grad.addColorStop(1, gradientColors[2]);
      ctx.fillStyle = grad;
      ctx.shadowColor = '#ffffff';
      ctx.shadowBlur = 12;
      ctx.fillText(text, w/2, h/2);
      const tex = new THREE.CanvasTexture(c);
      const mat = new THREE.SpriteMaterial({ map: tex, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false });
      return new THREE.Sprite(mat);
    }

    // Heart geometry generation (parametric)
    function createInvertedHeartGeometry(size=1, particleCount=1000){
      const positions = new Float32Array(particleCount*3);
      const colors = new Float32Array(particleCount*3);
      const colIn = new THREE.Color(params.insideColor);
      const colOut = new THREE.Color(params.outsideColor);
      for (let i=0;i<particleCount;i++){
        const i3 = i*3;
        const t = Math.random()*Math.PI*2;
        const x = 16*Math.pow(Math.sin(t),3);
        const y = 13*Math.cos(t) - 5*Math.cos(2*t) - 2*Math.cos(3*t) - Math.cos(4*t);
        const z = (Math.random()-0.5)*3;
        positions[i3]   = (x * size * 0.04) + (Math.random()-0.5)*size*0.08;
        positions[i3+1] = (y * size * 0.04) + (Math.random()-0.5)*size*0.08;
        positions[i3+2] = z * size * 0.08;
        const radius = Math.sqrt(x*x + y*y);
        const maxRadius = 20;
        const mixed = colIn.clone().lerp(colOut, Math.min(radius/maxRadius,1));
        colors[i3] = mixed.r; colors[i3+1] = mixed.g; colors[i3+2] = mixed.b;
      }
      const geo = new THREE.BufferGeometry();
      geo.setAttribute('position', new THREE.BufferAttribute(positions,3));
      geo.setAttribute('color', new THREE.BufferAttribute(colors,3));
      return geo;
    }

    function createStarfield(){
      const starCount = 4000;
      const positions = new Float32Array(starCount*3);
      const colors = new Float32Array(starCount*3);
      const sizes = new Float32Array(starCount);
      for (let i=0;i<starCount;i++){
        const i3 = i*3;
        const radius = 60 + Math.random()*200;
        const theta = Math.random()*Math.PI*2;
        const phi = Math.acos(2*Math.random()-1);
        positions[i3]   = radius * Math.sin(phi) * Math.cos(theta);
        positions[i3+1] = radius * Math.sin(phi) * Math.sin(theta);
        positions[i3+2] = radius * Math.cos(phi);
        const ct = Math.random();
        if (ct < 0.7){ colors[i3]=1; colors[i3+1]=1; colors[i3+2]=1; }
        else if (ct < 0.85){ colors[i3]=0.7; colors[i3+1]=0.8; colors[i3+2]=1; }
        else { colors[i3]=1; colors[i3+1]=0.9; colors[i3+2]=0.7; }
        sizes[i] = 0.2 + Math.random()*0.4;
      }
      const g = new THREE.BufferGeometry();
      g.setAttribute('position', new THREE.BufferAttribute(positions,3));
      g.setAttribute('color', new THREE.BufferAttribute(colors,3));
      g.setAttribute('size', new THREE.BufferAttribute(sizes,1));
      const m = new THREE.PointsMaterial({
        size:0.8, sizeAttenuation:true, vertexColors:true, transparent:true, opacity:params.starOpacity,
        blending:THREE.AdditiveBlending, depthWrite:false
      });
      return new THREE.Points(g,m);
    }

    function createNucleus(){
      const count = params.nucleusParticles;
      const pos = new Float32Array(count*3);
      const colors = new Float32Array(count*3);
      const sizes = new Float32Array(count);
      const c1 = new THREE.Color(0xff6030), c2 = new THREE.Color(0x0949f0);
      for (let i=0;i<count;i++){
        const i3=i*3;
        const r = Math.random()*0.8, t = Math.random()*Math.PI*2, p = Math.acos(2*Math.random()-1);
        pos[i3] = r*Math.sin(p)*Math.cos(t);
        pos[i3+1] = r*Math.sin(p)*Math.sin(t);
        pos[i3+2] = r*Math.cos(p);
        const mixed = c1.clone().lerp(c2, Math.random());
        colors[i3]=mixed.r; colors[i3+1]=mixed.g; colors[i3+2]=mixed.b;
        sizes[i] = 0.02 + Math.random()*0.03;
      }
      const g = new THREE.BufferGeometry();
      g.setAttribute('position', new THREE.BufferAttribute(pos,3));
      g.setAttribute('color', new THREE.BufferAttribute(colors,3));
      g.setAttribute('size', new THREE.BufferAttribute(sizes,1));
      const m = new THREE.PointsMaterial({
        size:0.03, sizeAttenuation:true, vertexColors:true, transparent:true, opacity:0.9,
        blending:THREE.AdditiveBlending, depthWrite:false
      });
      return new THREE.Points(g,m);
    }

    // Scene containers for dynamic rebuilds:
    let starfield = null;
    let centerHeart = null;
    let heartStructures = [];
    let heartCores = [];
    let textSprites = [];

    // Romantic phrases (kept short; emojis added cleanly)
    const romanticPhrases = [
      "üíõ Te amo", "üåπ Mi amor", "üëë Mi reina", "üíñ Siempre", "üåü Eres todo",
      "üíï Para siempre", "‚ú® Mi vida", "‚òÄÔ∏è Mi cielo", "üåû Mi sol", "üå∫ Bella",
      "üå∑ Hermosa", "üíê Preciosa", "üçØ Dulzura", "ü§ç Cari√±o", "üíù Amor m√≠o",
      "üë∏ Mi princesa", "üëº Mi √°ngel", "‚≠ê Mi estrella", "üåç Mi mundo", "üåà Eres √∫nica"
    ];

    function generateHearts() {
      // cleanup
      textSprites.forEach(s => scene.remove(s));
      textSprites = [];
      heartStructures.forEach(h => { h.geometry.dispose(); h.material.dispose(); scene.remove(h); });
      heartStructures = [];
      heartCores.forEach(c => { c.geometry.dispose(); c.material.dispose(); scene.remove(c); });
      heartCores = [];
      if (centerHeart) { centerHeart.geometry.dispose(); centerHeart.material.dispose(); scene.remove(centerHeart); centerHeart=null; }

      // orbital hearts
      for (let i=0;i<params.heartCount;i++){
        const heartSize = params.heartSize + Math.random()*params.heartSizeVariation;
        const geo = createInvertedHeartGeometry(heartSize, params.particlesPerHeart);
        const mat = new THREE.PointsMaterial({
          size: 0.025, sizeAttenuation:true, depthWrite:false, blending:THREE.AdditiveBlending, vertexColors:true, transparent:true, opacity:0.98
        });
        const pts = new THREE.Points(geo, mat);
        const radius = 3.8;
        const angle = (i/params.heartCount) * Math.PI*2;
        pts.position.set(Math.cos(angle)*radius, 0, Math.sin(angle)*radius);
        scene.add(pts);
        heartStructures.push(pts);

        // small core particle cloud at the same position
        const core = createNucleus();
        core.position.copy(pts.position);
        scene.add(core);
        heartCores.push(core);

        // small text near each heart
        const smallText = makeTextSprite("üíû Mi Ni√±a", 'Bold 20px Pacifico', 220, 50);
        smallText.position.copy(pts.position);
        smallText.position.y += 0.35;
        smallText.scale.set(0.6,0.15,1);
        scene.add(smallText);
        textSprites.push(smallText);
      }

      // central heart
      const centerGeo = createInvertedHeartGeometry(params.centerHeartSize, params.centerHeartParticles);
      const centerMat = new THREE.PointsMaterial({
        size:0.032, sizeAttenuation:true, vertexColors:true, transparent:true, blending:THREE.AdditiveBlending, depthWrite:false, opacity:0.99
      });
      centerHeart = new THREE.Points(centerGeo, centerMat);
      centerHeart.position.set(0,0,0);
      scene.add(centerHeart);

      // nucleus
      const nucleus = createNucleus();
      scene.add(nucleus);

      // main center text
      const centerText = makeTextSprite("üëë Andrea üëë", 'Bold 60px Pacifico', 512, 128);
      centerText.position.set(0,0.3,0);
      centerText.scale.set(2.0,0.5,1);
      scene.add(centerText);
      textSprites.push(centerText);

      // ambient romantic phrases sprinkled around
      for (let i=0;i<120;i++){
        const phrase = romanticPhrases[i % romanticPhrases.length];
        const spr = makeTextSprite(phrase, 'Bold 28px Pacifico', 280, 70);
        const r = 2.0 + Math.random()*4.0;
        const ang = Math.random()*Math.PI*2;
        const h = (Math.random()-0.5)*3.2;
        spr.position.set(Math.cos(ang)*r, h, Math.sin(ang)*r);
        spr.scale.set(0.55,0.12,1);
        scene.add(spr);
        textSprites.push(spr);
      }
    }

    // initial build
    starfield = createStarfield();
    scene.add(starfield);
    generateHearts();

    // renderer + camera + controls
    const sizes = { width: window.innerWidth, height: window.innerHeight };
    const renderer = new THREE.WebGLRenderer({ canvas, antialias:true, alpha:false });
    renderer.setSize(sizes.width, sizes.height);
    renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
    renderer.setClearColor(0x000000, 1);

    const camera = new THREE.PerspectiveCamera(75, sizes.width/sizes.height, 0.1, 200);
    camera.position.set(9,5,9);
    scene.add(camera);

    const controls = new OrbitControls(camera, renderer.domElement);
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.autoRotate = params.autoRotate;
    controls.autoRotateSpeed = params.autoRotateSpeed;
    controls.enableZoom = true;
    controls.enablePan = false;

    // handle resize
    window.addEventListener('resize', () => {
      sizes.width = window.innerWidth; sizes.height = window.innerHeight;
      camera.aspect = sizes.width / sizes.height; camera.updateProjectionMatrix();
      renderer.setSize(sizes.width, sizes.height);
      renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
    });

    // UI interactions
    const menuButton = document.getElementById('menuButton');
    const configPanel = document.getElementById('configPanel');
    const closeButton = document.getElementById('closeButton');
    const overlay = document.getElementById('overlay');

    menuButton.addEventListener('click', () => {
      configPanel.classList.add('open'); configPanel.setAttribute('aria-hidden','false'); overlay.classList.add('active');
    });
    [closeButton, overlay].forEach(el => el.addEventListener('click', () => {
      configPanel.classList.remove('open'); configPanel.setAttribute('aria-hidden','true'); overlay.classList.remove('active');
    }));

    // Controls bindings
    document.getElementById('heartSize').addEventListener('input', e => { params.heartSize = parseFloat(e.target.value); generateHearts(); });
    document.getElementById('centerHeartSize').addEventListener('input', e => { params.centerHeartSize = parseFloat(e.target.value); generateHearts(); });
    document.getElementById('heartSpeed').addEventListener('input', e => { params.autoRotateSpeed = parseFloat(e.target.value); controls.autoRotateSpeed = params.autoRotateSpeed; });
    document.getElementById('starBrightness').addEventListener('input', e => { params.starOpacity = parseFloat(e.target.value); if (starfield && starfield.material) starfield.material.opacity = params.starOpacity; });
    document.getElementById('textOpacity').addEventListener('input', e => { params.textOpacity = parseFloat(e.target.value); textSprites.forEach(s => { if(s.material) s.material.opacity = params.textOpacity; }); });
    document.getElementById('autoRotateToggle').addEventListener('change', e => { params.autoRotate = e.target.checked; controls.autoRotate = params.autoRotate; });

    // color options
    document.querySelectorAll('.color-option').forEach(opt => {
      opt.addEventListener('click', () => {
        document.querySelectorAll('.color-option').forEach(o => o.classList.remove('active'));
        opt.classList.add('active');
        const color = opt.dataset.color;
        params.insideColor = color; params.outsideColor = color;
        generateHearts();
      });
    });

    // animation loop
    const clock = new THREE.Clock();
    function animate(){
      const elapsed = clock.getElapsedTime();
      controls.update();

      // face camera
      textSprites.forEach(s => s.lookAt(camera.position));
      heartStructures.forEach(h => h.lookAt(camera.position));
      if (centerHeart) centerHeart.lookAt(camera.position);
      heartCores.forEach((core, idx) => { if (heartStructures[idx]) core.position.copy(heartStructures[idx].position); core.lookAt(camera.position); });

      // simple twinkle for stars
      if (starfield && starfield.geometry && starfield.geometry.attributes.size) {
        const sizes = starfield.geometry.attributes.size.array;
        for (let i=0;i<sizes.length;i++){
          const pulse = Math.sin(elapsed*0.5 + i*0.01)*0.2 + 0.8;
          sizes[i] = (0.2 + Math.random()*0.4) * pulse;
        }
        starfield.geometry.attributes.size.needsUpdate = true;
      }

      renderer.render(scene, camera);
      requestAnimationFrame(animate);
    }
    animate();

    // keyboard: press Esc to close panel
    window.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape') {
        configPanel.classList.remove('open'); overlay.classList.remove('active');
      }
    });

    /* ---------- Audio: set src from JS so we can encode safely; autoplay respects user gesture policies ---------- */
    const audio = document.getElementById('bg-music');

    // Original file was hosted on GitHub with spaces; best practice: host audio without spaces or on a static host (CDN).
    // We'll set src using encodeURI for safety; if GitHub raw blocks, host elsewhere.
    const rawUrl = "https://github.com/Gon-p/G-/raw/refs/heads/main/adore - did i tell u that i miss u_ (lyric video).m4a";
    audio.src = encodeURI(rawUrl); // encode spaces and special chars

    // Preferred: replace audio.src with a proper static URL if the GitHub raw link doesn't stream correctly.
    audio.volume = 0.4;
    audio.muted = false;

    // Start audio only after first user interaction to avoid autoplay being blocked.
    function tryPlayAudio() {
      audio.play().catch(() => { /* suppressed: browsers often block autoplay; user can click to start */ });
      document.removeEventListener('click', tryPlayAudio);
      document.removeEventListener('touchstart', tryPlayAudio);
    }
    document.addEventListener('click', tryPlayAudio, { once:true });
    document.addEventListener('touchstart', tryPlayAudio, { once:true });

  </script>
</body>
</html>
